@import "tailwindcss";
@import "tw-animate-css";
@import "./tailwind-typography";
@import "./font";

@theme {
  /*** Font stacks ***/
  --font-text: OBOSText, __OBOSText_Fallback, sans-serif;
  --font-display: OBOSDisplay, __OBOSDisplay_Fallback, sans-serif;

  /*** Widths ***/
  --container-width: 92rem;
  --container-gutter-width: 1rem;

  /*** Colors ***/
  --color-black: #333;
  --color-white: #fff;
  --color-gray: #818181;
  --color-gray-dark: #595959;
  --color-gray-light: #e6e6e6;
  --color-gray-lightest: #f1f1f1;
  --color-sky: #bedfec;
  --color-sky-light: #deeff5;
  --color-sky-lightest: #ebf5f9;
  --color-mint: #cdece2;
  --color-mint-light: #e6f5f0;
  --color-mint-lightest: #f0f9f6;
  --color-blue: #0047ba;
  --color-blue-light: #bedfec;
  --color-blue-lightest: #deeff5;
  --color-blue-dark: #002169;
  --color-green: #008761;
  --color-green-dark: #00524c;
  --color-green-light: #cdece2;
  --color-green-lightest: #e6f5f0;
  --color-red: #c0385d;
  --color-red-light: #faedef;
  --color-orange: #e8a74a;
  --color-orange-light: #f8e5c9;
  --color-yellow: #fff5d2;

  /** Breakpoints ***/
  --breakpoint-3xl: 108rem;
  --breakpoint-4xl: 120rem;
}

@layer base {
  @font-face {
    font-family: OBOSText;
    font-weight: 400;
    font-style: normal;
    src: url("https://www.obos.no/fonts/OBOSText-Regular.woff2") format("woff2");
    font-display: swap;
  }

  @font-face {
    font-family: OBOSText;
    font-weight: 400;
    font-style: italic;
    src: url("https://www.obos.no/fonts/OBOSText-Italic.woff2") format("woff2");
    font-display: swap;
  }

  @font-face {
    font-family: OBOSText;
    font-weight: 500;
    font-style: normal;
    src: url("https://www.obos.no/fonts/OBOSText-Medium.woff2") format("woff2");
    font-display: swap;
  }

  @font-face {
    font-family: OBOSDisplay;
    font-weight: 600; /* SemiBold */
    font-style: normal;
    src: url("https://www.obos.no/fonts/OBOSDisplay-SemiBold.woff2")
      format("woff2");
    font-display: swap;
  }

  html {
    @apply text-black antialiased font-normal font-text;
  }

  b {
    font-weight: 500;
  }

  strong {
    font-weight: 500;
  }

  a {
    text-decoration: underline;
  }

  ::selection {
    @apply bg-mint text-black;
  }
}

/*** Layout ***/
@utility page-layout {
  @apply flex flex-col min-h-screen;
}

@utility page-layout-main {
  @apply bg-white grow;
}

/** Grid column spacing */
@utility layout-grid-gap-x {
  @apply sm:gap-x-4 md:gap-x-9 lg:gap-x-12 xl:gap-x-16;
}

/** Grid base, defines the grid columns and their spacing */
@utility layout-grid {
  @apply layout-grid-gap-x sm:grid-cols-14 grid;
}

/** Grid container that applies the grid columns, grid spacing and the container component class */
@utility layout-grid-container {
  @apply layout-grid container;
  /** Make content of the grid span the mid 12 columns as a default (unless it has another explicit col-span class) */
  & > * {
    @apply sm:col-start-2 sm:col-span-12;
  }
}

@utility layout-subgrid-* {
  @apply layout-grid-gap-x grid;
}

@utility layout-subgrid-1 {
  @apply grid-cols-1;
}
@utility layout-subgrid-2 {
  @apply grid-cols-2;
}
@utility layout-subgrid-3 {
  @apply grid-cols-3;
}
@utility layout-subgrid-4 {
  @apply grid-cols-4;
}
@utility layout-subgrid-5 {
  @apply grid-cols-5;
}
@utility layout-subgrid-6 {
  @apply grid-cols-6;
}
@utility layout-subgrid-7 {
  @apply grid-cols-7;
}
@utility layout-subgrid-8 {
  @apply grid-cols-8;
}
@utility layout-subgrid-9 {
  @apply grid-cols-9;
}
@utility layout-subgrid-10 {
  @apply grid-cols-10;
}
@utility layout-subgrid-11 {
  @apply grid-cols-11;
}
@utility layout-subgrid-12 {
  @apply grid-cols-12;
}

@utility layout-gap-x {
  @apply gap-x-2;
  @apply layout-grid-gap-x;
}

@utility layout-gap-y {
  @apply gap-y-4 sm:gap-y-6 md:gap-y-8 lg:gap-y-10 xl:gap-y-12;
}

@utility container {
  @apply w-full px-(--container-gutter-width) mx-auto max-w-(--container-width);
}

@utility container-prose {
  @apply w-full px-(--container-gutter-width) mx-auto;
  max-width: 45.5rem;
}

/*** Typography styles ***/
@utility heading-xl {
  @apply font-display font-semibold text-[2.8125rem]/[3.625rem] lg:text-[3.9375rem]/[5.125rem];
}

@utility heading-l {
  @apply font-display font-semibold text-[1.8125rem]/[2.75rem] lg:text-[2.25rem]/[3.5rem];
}

@utility heading-m {
  @apply font-text font-medium text-[1.4375rem]/[2.25rem] lg:text-[1.625rem]/[2.5625rem];
}

@utility heading-s {
  @apply font-text font-medium text-[1.1875rem]/[1.875rem] lg:text-[1.3125rem]/[2.125rem];
}

@utility heading-xs {
  @apply font-text font-medium text-[1.125rem]/[1.75rem] lg:text-[1.1875rem]/[1.9375rem];
}

@utility paragraph {
  @apply text-[1rem]/[1.625rem];
}

@utility lead {
  @apply font-medium text-[1.4375rem]/[2.25rem] lg:text-[1.625rem]/[2.5625rem];
}

@utility blockquote {
  @apply font-medium italic grid grid-cols-[3rem_1fr] gap-x-[0.4375rem] pt-4 text-[1.625rem]/[2.5625rem] lg:text-[1.4375rem]/[2.25rem] before:text-[4.6875rem]/[1.6875rem] before:font-display before:not-italic before:content-["â€œ"];
}

@utility description {
  @apply text-[0.875rem]/[1.375rem] lg:text-[0.875rem]/[1.4375rem];
}

/* Focus styles */
@utility outline-focus {
  @apply outline-2 outline-black;
}

@utility outline-focus-offset {
  @apply outline-focus outline-offset-2;
}

@utility outline-focus-inset {
  @apply outline-focus -outline-offset-4;
}

@utility ring-focus {
  @apply ring-2 ring-black;
}

@utility ring-focus-offset {
  @apply ring-focus ring-offset-2;
}

/** Hides the scrollbar visually */
@utility scrollbar-hidden {
  /* For IE, Edge and Firefox */
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */

  /* For Webkit-based browsers (Chrome, Safari and Opera) */
  &::-webkit-scrollbar {
    display: none;
  }
}

@layer components {
  /*** Link List component styles ***/
  .link-list-container {
    @apply @container;

    &:has([data-slot="heading"]) {
      .link-list,
      [data-slot="link-list"] {
        @apply overflow-visible;
      }
    }

    [data-slot="heading"] {
      @apply p-1.25;

      [data-slot="link"] {
        @apply py-2.25;
        & > svg {
          @apply text-base;
        }
      }

      &:not(:has([data-slot="link"])) {
        @apply my-2.25;
      }
    }

    [data-slot="link-list"] {
      @apply @sm:gap-x-4 @md:gap-x-9 @lg:gap-x-12 @xl:gap-x-16;

      &:has([data-slot="link-list-item"]:nth-child(6)):not(
          :has([data-slot="link-list-item"]:nth-child(9):last-child)
        ):not(:has([data-slot="link-list-item"]:nth-child(11))) {
        @apply @4xl:grid-cols-2;
      }
      &:has([data-slot="link-list-item"]:nth-child(9):last-child),
      &:has([data-slot="link-list-item"]:nth-child(11)) {
        @apply @4xl:grid-cols-3;
      }
    }
  }

  .link-list,
  [data-slot="link-list"] {
    /**
     * Hides dividers at the top of the list (overflow-y)
     * while preventing arrow icons from overflowing container when animated to the right (overflow-x)
     */
    @apply min-w-fit overflow-hidden grid auto-rows-max gap-y-px;
  }

  .link-list-item,
  [data-slot="link-list-item"] {
    /** Creates divider lines that works in any grid layout and with the focus ring */
    @apply after:-top-px relative p-1.25 after:absolute after:right-0 after:left-0 after:h-px after:w-full after:bg-gray-light;
    [data-slot="link"] {
      @apply paragraph;
    }
  }

  .link-list-container,
  .link-list-item,
  [data-slot="link-list-item"] {
    [data-slot="link"] {
      @apply flex w-full cursor-pointer justify-between gap-x-2 py-3.5 font-medium no-underline focus-visible:outline-focus;
    }
  }

  .link-list-container [data-slot="link"],
  [data-slot="link-list-item"] [data-slot="link"] {
    &:hover:not([download]):not([rel~="external"]) svg {
      @apply motion-safe:translate-x-1;
    }
    &[download]:hover svg {
      @apply motion-safe:translate-y-1;
    }
    &[rel~="external"]:hover svg {
      @apply motion-safe:-translate-y-0.5 motion-safe:translate-x-0.5;
    }
  }

  /*** FormSteps component styles ***/
  .form-steps,
  [data-slot="form-steps"] {
    counter-reset: form-step-counter;
    @apply flex gap-x-3 lg:flex-col lg:gap-y-14 max-w-full min-w-0 relative;

    [data-slot="form-step"] {
      counter-increment: form-step-counter;
      @apply flex items-center gap-x-3 relative;

      &::before {
        content: counter(form-step-counter);
      }

      &::before,
      &[data-expanded]::after {
        @apply shrink-0 font-semibold size-8 border-2 rounded-full border-blue-dark grid place-content-center;
      }

      /** Place the focus styles on the ::before element instead of the link, since the link text is not visible on smaller screens */
      &:has([data-slot="link"]:focus-visible) {
        &::before {
          @apply outline-focus-offset;
        }
      }

      [data-slot="link"] {
        @apply focus-visible:outline-none;
        /** Create a 44x44 px clickable area, where the step number next to each link will also be covered **/
        @apply py-2.5 pl-11 -ml-11 -my-2.5;
      }

      &[data-state="current"] {
        &::before {
          @apply bg-sky-light border-4 text-blue-dark;
        }
      }

      &[data-state="completed"] {
        &::before,
        &[data-expanded]::after {
          @apply bg-blue-dark text-white;
        }
      }

      &[data-state="completed"] {
        svg {
          @apply text-white absolute scale-60 border-2 border-white bg-blue-dark rounded-full left-4 -top-2;
        }
      }

      &[data-state="pending"]::before {
        @apply bg-white text-blue-dark;
      }

      &:not(:last-child) {
        [data-slot="progress-bar"] {
          @apply w-4 max-lg:grow lg:w-14 lg:rotate-90 lg:absolute lg:-left-3 lg:px-1.5 lg:-bottom-[calc(100%-2px)];
        }

        &[data-state="pending"] {
          @apply max-lg:shrink;

          [data-slot="progress-bar"] {
            @apply max-lg:shrink;
          }
        }
      }

      & > *:is([data-slot="text"], [data-slot="link"]) {
        @apply max-lg:opacity-0;
      }

      & > *:is([data-slot="text"], [data-slot="link"]) {
        @apply max-lg:absolute;
      }

      &[data-state="current"] {
        @apply max-lg:justify-center;
        & > *:is([data-slot="text"], [data-slot="link"]) {
          @apply max-lg:-top-full;
          &::after {
            @apply max-lg:-bottom-[200%] max-lg:ml-9.5;
          }
        }
      }
    }

    [data-slot="toggle-check-icon"] {
      @apply hidden;
    }

    /** If there are 5 or more form steps: **/
    &:has([data-slot="form-step"]:nth-child(5)) {
      /** Where the second last step is still pending: We stack all the pending steps on top of each other on small screens. **/
      &:has(
          [data-slot="form-step"]:nth-last-child(2):is([data-state="pending"])
        ) {
        [data-state="pending"] {
          &:nth-child(n + 4) {
            &:not([data-state="current"] + *, :nth-child(4)) {
              @apply max-sm:-ml-9;
            }
            [data-slot="progress-bar"] {
              @apply max-sm:sr-only;
            }
          }
          &:nth-child(4)::before {
            @apply max-sm:z-4;
          }
          &:nth-child(5)::before {
            @apply max-sm:z-3;
          }
          &:nth-child(6)::before {
            @apply max-sm:z-2;
          }
          &:nth-child(7)::before {
            @apply max-sm:z-1;
          }
        }
      }

      /** Where the third step is completed: We hide all the completed steps in a "popover" **/
      &:has([data-slot="form-step"]:nth-child(3):is([data-state="completed"])) {
        /** Styles the "popover" trigger used for touch/mouse interactions to display the popover **/
        [data-slot="form-step"] {
          &:nth-child(2) {
            &::before {
              /** Announce as "2" for screen readers (since this is rendered in step 2) but display as '...' visually **/
              @apply max-sm:content-['...'_/_'2'];
            }
          }
        }

        /** Hides all the completed steps between step 2 and the current **/
        /** For both keyboard users and touch/mouse users (screen reader users will not notice this) **/
        &:not(
            :has(
                [data-state="completed"]:not(:nth-child(1)):not(
                    :nth-last-child(2)
                  ):focus-within
              ),
            :has([data-slot="form-step"][data-expanded="true"])
          ) {
          [data-slot="form-step"] {
            &:nth-child(3),
            /** Impotant to exclude if the fourth child is the same as the second from the back, i.e. 5 items */
              &:nth-child(4):not(:nth-last-child(2)),
            /** Impotant to exclude if the second child is the same as the fourth from the back, i.e. 5 items */
              /** This is because the second child is used as a disclosure toggle on smaller screens.*/
              &:nth-last-child(4):not(:nth-child(2)),
            &:nth-last-child(3) {
              &[data-state="completed"] {
                @apply max-sm:sr-only;
              }
            }
          }
        }

        /** Displays all the completed steps between step 2 and the current in a "popover" **/
        /** For both keyboard users and touch/mouse users (screen reader users will not notice this) **/
        &:has(
            [data-state="completed"]:not(:nth-child(1)):not(
                :nth-last-child(2)
              ):focus-within
          ),
        &:has([data-slot="form-step"][data-expanded="true"]) {
          [data-slot="form-step"] {
            &:nth-child(2),
            &:nth-child(3),
            /** Impotant to exclude if the fourth child is the same as the second from the back, i.e. 5 items */
              &:nth-child(4):not(:nth-last-child(2)),
            &:nth-last-child(4),
            &:nth-last-child(3) {
              /** All the completed steps needs to be absolutely positioned, with an offset that makes them stack vertically. **/
              &[data-state="completed"] {
                /** For the step 2, the ::before element is now acting as the popover trigger. So we need to use the ::after element as a visual step number indicator instead **/
                &:nth-child(2) {
                  &::after,
                  [data-slot="link"],
                  [data-slot="toggle-check-icon"] {
                    @apply max-sm:absolute;
                  }
                  &::after {
                    @apply max-sm:-left-14 max-sm:top-15 max-sm:z-1;
                    /** Makes this pseudo element visible, while also reflecting the order in the list, while hiding it for screen reader users. This is because the list item counter is reflected in the ::before element for screen readers  */
                    @apply max-sm:content-[counter(form-step-counter)_/_''];
                  }
                  /** Place the focus styles on the ::after element instead of the link, to match the rest of the list items */
                  &:has([data-slot="link"]:focus-visible) {
                    &::after {
                      @apply max-sm:outline-focus-offset;
                    }
                  }
                  &::before {
                    /** Hide the focus outline on the element acting as the "popover" trigger **/
                    @apply max-sm:outline-none;
                  }

                  [data-slot="link"] {
                    @apply max-sm:-left-3 max-sm:top-16 max-sm:z-2;
                  }
                  [data-slot="toggle-check-icon"] {
                    @apply max-sm:-left-10 max-sm:z-2 max-sm:top-12.5 max-sm:block;
                  }
                }

                &:not(:nth-child(2)) {
                  @apply max-sm:absolute max-sm:left-4 max-sm:w-full;
                  /** Use stacked pseudo elements to create the illusion of a popover container **/
                  @apply max-sm:after:absolute max-sm:after:-left-4 max-sm:after:right-4;
                  @apply max-sm:after:-top-[calc(200%+var(--spacing)*4)] max-sm:after:-bottom-4;
                  /** Paints the "popover container" **/
                  @apply max-sm:after:bg-white max-sm:after:border-x max-sm:after:border-b max-sm:after:rounded-b-lg;

                  & > *:is([data-slot="text"], [data-slot="link"]) {
                    @apply max-sm:relative;
                  }
                  & > *:is([data-slot="text"], [data-slot="link"], svg),
                  &::before {
                    @apply max-sm:z-1;
                  }
                  [data-slot="progress-bar"] {
                    @apply max-sm:sr-only;
                  }
                }
                [data-slot="link"] {
                  /** Make the link appear visually and position the link pseudo element acting as click area for the step number **/
                  @apply max-sm:opacity-100 max-sm:static max-sm:after:-left-11;
                  /** Truncate texts that does not fit the width of the popover (the inline-flex of the link must be overridden as block) **/
                  /** We need to do this because we can't wrap over multiple lines, due to the absolute positioning of each step in the popover **/
                  @apply max-sm:max-w-53.5 max-sm:text-ellipsis max-sm:overflow-hidden max-sm:whitespace-nowrap max-sm:block!;
                }

                /** Position each step correctly inside the "popover" (with an even spacing) **/
                &:nth-child(3) {
                  @apply max-sm:top-30;
                }
                &:nth-child(4) {
                  @apply max-sm:top-45;
                }
                &:nth-child(5) {
                  @apply max-sm:top-60;
                }
                &:nth-child(6) {
                  @apply max-sm:top-75;
                }
              }
              &:nth-child(3) {
                /** Paints the top part of the "popover container" **/
                @apply max-sm:after:border-t max-sm:after:rounded-t-lg;
              }
            }
          }
        }
      }
    }
  }
}
